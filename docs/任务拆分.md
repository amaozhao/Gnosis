# Gnosis 项目 MVP 任务拆分与优先级

**总预计时间：** 20 天

---

## 阶段 1: 核心基础设施与基本文件处理 (预计 5 天)

**目标：** 建立项目基础，实现文本文件的基本读写和处理。

*   **第 1 天：项目初始化与环境设置 (高优先级)**
    *   创建 `Gnosis` 项目根目录。
    *   初始化 Git 仓库。
    *   设置 Python 虚拟环境 (`venv`)。
    *   安装核心依赖：`agno`、`httpx`、`tqdm`、`pydantic`、`pydantic-settings`。
    *   创建 `requirements.txt` 文件。
    *   定义基础项目结构：`gnosis/`、`cli.py`、`gnosis/core/`、`gnosis/agents/`、`gnosis/services/`。
    *   实现基础 `logger` 配置（控制台输出，INFO 级别）。
*   **第 2 天：基本文件处理模块开发 (高优先级)**
    *   在 `gnosis/services/` 中开发 `subtitle.py` 模块，用于基本的文件读写操作。
    *   实现简单的文本文件读取功能，不需要特殊解析。
    *   实现简单的文本文件写入功能。
    *   确保文件操作使用 UTF-8 编码。
    *   编写基本的单元测试。
*   **第 3 天：智能体输入输出格式设计 (高优先级)**
    *   设计智能体输入格式，确保文本内容能被智能体有效处理。
    *   设计智能体输出格式，确保翻译结果能被正确保存。
    *   在 `gnosis/agents/` 中创建基础智能体接口。
    *   编写基本的单元测试。
*   **第 4 天：异步文件 I/O 集成 (高优先级)**
    *   重构 `subtitle.py` 模块，使用 `aiofiles` 库实现异步文件操作。
    *   为文件操作（例如 `FileNotFoundError`、`PermissionError`）实现基本的错误处理。
    *   使用模拟数据测试异步文件操作的正确性。
*   **第 5 天：核心应用逻辑骨架 (高优先级)**
    *   在 `gnosis/core/` 中完善 `config.py` 和 `logger.py`，用于配置和日志记录。
    *   定义一个高层异步函数 `process_file(input_path, output_path, src_lang, target_lang)`。
    *   设置基础配置加载机制（例如，从环境变量加载 API 密钥）。

---

## 阶段 2: 单智能体翻译核心 (预计 5 天)

**目标：** 实现基于 Agno 框架的单个翻译智能体，并将其集成到核心翻译流程中。

*   **第 6 天：Agno 框架设置与 LLM 客户端 (高优先级)**
    *   安装选定 LLM 的 SDK（例如 `openai` 或 `google-generativeai`）。
    *   配置 Agno 框架以使用特定的 LLM 模型（例如 OpenAI GPT-4o-mini 或 Google Gemini 1.5 Flash）。
    *   安全地从环境变量加载 LLM API 密钥。
    *   编写一个简单的测试脚本，验证 LLM 连接和基本的文本生成功能。
*   **第 7 天：翻译智能体实现 (MVP) (高优先级)**
    *   在 `gnosis/agents/` 中完善 `translator.py` 模块，实现翻译功能。
    *   使用选定的 LLM 和基本的翻译指令配置 `TranslatorAgent`。
    *   在智能体内部实现一个方法 `translate_text(text, src_lang, target_lang)`，用于执行文本翻译。
    *   MVP 阶段，专注于直接翻译，不涉及复杂的 RAG 或工具。
*   **第 8 天：翻译智能体集成到核心逻辑 (高优先级)**
    *   修改 `cli.py`，实例化并使用翻译智能体。
    *   将读取的文本内容传递给 `TranslatorAgent` 进行翻译。
    *   处理潜在的 LLM API 错误（例如，速率限制、无效 API 密钥）。
    *   实现 `asyncio.Semaphore` 来控制并发的 LLM API 调用数量，以避免触发速率限制。
*   **第 9 天：端到端翻译测试 (核心) (高优先级)**
    *   创建用于测试的模拟文本文件。
    *   运行集成 `TranslatorAgent` 的 `process_file` 函数。
    *   验证输出文件的内容是否正确。
    *   记录成功的翻译和遇到的任何错误。
*   **第 10 天：基础日志增强与错误报告 (中优先级)**
    *   优化 `logging` 配置，为翻译进度添加更详细的 `INFO` 消息（例如，"正在翻译文件"）。
    *   确保 `ERROR` 和 `CRITICAL` 消息格式清晰，并包含相关上下文（例如，错误类型）。
    *   在核心逻辑中为未处理的异常实现 `logging.exception()`。

---

## 阶段 3: 基础 CLI 与集成 (预计 5 天)

**目标：** 构建一个可用的命令行界面，支持单文件和文件夹的批量翻译。

*   **第 11 天：CLI 参数解析 (高优先级)**
    *   使用 `argparse`（Python 标准库）定义命令行参数：`input_path`（输入文件或文件夹）、`output_dir`（输出目录）、`src_lang`（源语言）、`target_lang`（目标语言）。
    *   实现对参数类型和存在性的基本验证。
    *   在 `cli.py` 中设置主要的 CLI 入口点。
*   **第 12 天：CLI 协调 (单文件) (高优先级)**
    *   将 CLI 参数与核心处理函数连接起来。
    *   实现处理单个输入文件的逻辑。
    *   从 CLI 入口点调用异步处理函数。
*   **第 13 天：CLI 进度条 (TQDM) (高优先级)**
    *   将 `tqdm` 库集成到 `cli.py` 中的处理函数，以显示翻译进度。
    *   确保进度条正确更新并提供预计剩余时间。
*   **第 14 天：CLI 批量处理 (文件夹) (高优先级)**
    *   扩展 CLI 以接受文件夹路径作为 `input_path`。
    *   实现递归遍历输入文件夹，查找所有文本文件。
    *   协调对每个找到的文件调用处理函数。
    *   更新 `tqdm` 以显示整个文件夹的总体进度。
*   **第 15 天：端到端 CLI 测试与文档 (高优先级)**
    *   对 CLI 进行全面的端到端测试，包括单文件和文件夹处理。
    *   测试各种场景：有效文件、无效文件、不存在的路径、LLM API 错误。
    *   编写基础的 CLI 使用文档（在 `README.md` 中添加一个部分）。

---

## 阶段 4: 完善与测试 (预计 5 天)

**目标：** 确保 MVP 的稳定性、可靠性和可用性。

*   **第 16 天：单元测试扩展 (高优先级)**
    *   审查并扩展所有核心模块（`subtitle`、`config`、`logger`、`agents`）的单元测试。
    *   争取实现较高的代码覆盖率。
*   **第 17 天：集成测试与边缘情况 (高优先级)**
    *   开发针对完整 CLI 工作流的集成测试。
    *   测试文件处理的边缘情况（例如，空文件、超大文件、编码问题）。
    *   通过模拟条件（例如，模拟 LLM API 速率限制）测试 LLM 错误处理。
*   **第 18 天：代码审查与重构 (中优先级)**
    *   进行内部代码审查。
    *   重构任何已识别的模块化、可读性和符合 Python 最佳实践的改进区域。
    *   确保异步模式的一致使用。
*   **第 19 天：文档与用户指南 (中优先级)**
    *   为 MVP 创建一份基础用户指南，涵盖安装、CLI 使用和常见问题排查。
    *   更新项目 `README`，提供清晰的说明和示例。
*   **第 20 天：最终 MVP 审查与发布准备 (高优先级)**
    *   对所有功能进行最终审查，对照 MVP 需求进行核对。
    *   准备首次内部发布或演示。
    *   确定 MVP 后续开发的下一步计划（例如，GUI、完整多智能体系统）。
